<map version="freeplane 1.8.0">
<!--To view this file, download free mind mapping software Freeplane from http://freeplane.sourceforge.net -->
<node TEXT="lvs集群" FOLDED="false" ID="ID_356271095" CREATED="1609835088976" MODIFIED="1609835185031" STYLE="oval">
<font SIZE="18"/>
<hook NAME="MapStyle" zoom="0.754">
    <properties fit_to_viewport="false" edgeColorConfiguration="#808080ff,#ff0000ff,#0000ffff,#00ff00ff,#ff00ffff,#00ffffff,#7c0000ff,#00007cff,#007c00ff,#7c007cff,#007c7cff,#7c7c00ff"/>

<map_styles>
<stylenode LOCALIZED_TEXT="styles.root_node" STYLE="oval" UNIFORM_SHAPE="true" VGAP_QUANTITY="24.0 pt">
<font SIZE="24"/>
<stylenode LOCALIZED_TEXT="styles.predefined" POSITION="right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="default" ICON_SIZE="12.0 pt" COLOR="#000000" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt" NUMBERED="true" BORDER_WIDTH="2.0 px">
<font NAME="微软雅黑" SIZE="12" BOLD="false" ITALIC="false"/>
<edge STYLE="horizontal"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.details" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt"/>
<stylenode LOCALIZED_TEXT="defaultstyle.attributes" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt">
<font SIZE="9"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.note" COLOR="#000000" BACKGROUND_COLOR="#ffffff" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt" TEXT_ALIGN="LEFT"/>
<stylenode LOCALIZED_TEXT="defaultstyle.floating">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.user-defined" POSITION="right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="styles.topic" COLOR="#18898b" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt">
<font NAME="Liberation Sans" SIZE="10" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subtopic" COLOR="#cc3300" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt">
<font NAME="Liberation Sans" SIZE="10" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subsubtopic" COLOR="#669900" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt">
<font NAME="Liberation Sans" SIZE="10" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.important" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt">
<icon BUILTIN="yes"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.AutomaticLayout" POSITION="right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="AutomaticLayout.level.root" COLOR="#000000" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt">
<font SIZE="18"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,1" COLOR="#0033ff" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt">
<font SIZE="16"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,2" COLOR="#00b439" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt">
<font SIZE="14"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,3" COLOR="#990000" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt">
<font SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,4" COLOR="#111111" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt">
<font SIZE="10"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,5" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,6" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,7" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,8" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,9" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,10" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,11" STYLE="bubble" SHAPE_HORIZONTAL_MARGIN="5.0 pt" SHAPE_VERTICAL_MARGIN="3.0 pt"/>
</stylenode>
</stylenode>
</map_styles>
</hook>
<hook NAME="AutomaticEdgeColor" COUNTER="7" RULE="ON_BRANCH_CREATION"/>
<node TEXT="特点" POSITION="right" ID="ID_1096885350" CREATED="1609835121525" MODIFIED="1609835227760">
<edge COLOR="#ff0000"/>
<node TEXT="章文嵩创建,集成在linux内核中,实现方式类似路由器,体量小,性能高,没有健康检查功能,需要配合keepalived实现健康检查功能和高可用" ID="ID_1594471317" CREATED="1609835227770" MODIFIED="1609838383230"/>
<node TEXT="术语" ID="ID_1071623052" CREATED="1609835518080" MODIFIED="1609835527519">
<node TEXT="Director Server调度服务器" ID="ID_1941732574" CREATED="1609835527530" MODIFIED="1609835549740"/>
<node TEXT="Real Server真实服务器" ID="ID_869868708" CREATED="1609835550107" MODIFIED="1609835563199"/>
<node TEXT="VIP虚拟IP地址" ID="ID_9084059" CREATED="1609835563371" MODIFIED="1609835586284"/>
<node TEXT="DIP调度器连接后端节点服务器的IP地址" ID="ID_968531909" CREATED="1609835586820" MODIFIED="1609835624789"/>
<node TEXT="RIP真实节点服务器IP地址" ID="ID_1822394300" CREATED="1609835625180" MODIFIED="1609835650184"/>
</node>
<node TEXT="工作模式" ID="ID_810030664" CREATED="1609835667851" MODIFIED="1609835671681">
<node TEXT="NAT模式" ID="ID_285957276" CREATED="1609835671696" MODIFIED="1609835677461">
<node TEXT="通过网络地址转换实现的虚拟服务器,往返数据均经过调度服务器" ID="ID_1298370477" CREATED="1609835701822" MODIFIED="1609835783686"/>
<node TEXT="大并发访问时,调度器性能称为瓶颈" ID="ID_371148066" CREATED="1609835725031" MODIFIED="1609835755710"/>
</node>
<node TEXT="TUN模式" ID="ID_1865973621" CREATED="1609835677631" MODIFIED="1609835683741">
<node TEXT="随道方式实现虚拟服务器,节点直接返回数据,高安全性,但比较少见" ID="ID_699527081" CREATED="1609835802891" MODIFIED="1609835947275"/>
</node>
<node TEXT="DR模式" ID="ID_1395322406" CREATED="1609835683891" MODIFIED="1609835687371">
<node TEXT="直接使用路由技术实现虚拟服务器,访问请求由调度器接收,返回数据由节点直接返回" ID="ID_920895392" CREATED="1609835834381" MODIFIED="1609835889215"/>
<node TEXT="节点服务器需要配置VIP,网络配置相对复杂" ID="ID_29069807" CREATED="1609835889425" MODIFIED="1609835914876"/>
</node>
</node>
<node TEXT="调度算法" ID="ID_620557935" CREATED="1609835971945" MODIFIED="1609835979565">
<node TEXT="轮询" ID="ID_1310307296" CREATED="1609835979585" MODIFIED="1609835988415">
<node TEXT="Round Robin" ID="ID_1959721649" CREATED="1609836021515" MODIFIED="1609836035765"/>
</node>
<node TEXT="加权轮询" ID="ID_1912528706" CREATED="1609835988765" MODIFIED="1609835995725">
<node TEXT="Weighted Round Robin" ID="ID_1804565526" CREATED="1609836037565" MODIFIED="1609836070269"/>
</node>
<node TEXT="最少连接" ID="ID_1077936712" CREATED="1609835995875" MODIFIED="1609836013485">
<node TEXT="Least Connections" ID="ID_1647686808" CREATED="1609836072695" MODIFIED="1609836085595"/>
</node>
<node TEXT="加权最少连接" ID="ID_1133446972" CREATED="1609836013655" MODIFIED="1609836019565">
<node TEXT="Weighted Least Connections" ID="ID_841023281" CREATED="1609836087245" MODIFIED="1609836110278"/>
</node>
<node TEXT="其他" ID="ID_1924050683" CREATED="1609836123265" MODIFIED="1609836126005">
<node TEXT="源地址散列" ID="ID_674093409" CREATED="1609836126025" MODIFIED="1609836135666">
<node TEXT="Source Hashing" ID="ID_1568594912" CREATED="1609836135685" MODIFIED="1609836143185"/>
</node>
<node TEXT="目标地址散列" ID="ID_1965176117" CREATED="1609836144325" MODIFIED="1609836152905">
<node TEXT="Destination Hashing" ID="ID_83511513" CREATED="1609836152915" MODIFIED="1609836162545"/>
</node>
<node TEXT="基于局部性的最少连接" ID="ID_411944365" CREATED="1609836163525" MODIFIED="1609836184295"/>
<node TEXT="带复制的基于局部性最少连接" ID="ID_1202231775" CREATED="1609836184505" MODIFIED="1609836199651"/>
<node TEXT="最短的期望的延迟" ID="ID_983727975" CREATED="1609836199882" MODIFIED="1609836216949"/>
<node TEXT="最少队列调度" ID="ID_1461573465" CREATED="1609836217159" MODIFIED="1609836223679"/>
</node>
</node>
</node>
<node TEXT="部署" POSITION="right" ID="ID_1791499593" CREATED="1609836239009" MODIFIED="1609836242499">
<edge COLOR="#0000ff"/>
<node TEXT="安装管理工具包ipvsadm" ID="ID_637097181" CREATED="1609836242509" MODIFIED="1609836323679"/>
<node TEXT="用法" ID="ID_1743510479" CREATED="1609836380469" MODIFIED="1609836387259">
<node TEXT="ipvsadm命令选项" ID="ID_786566047" CREATED="1609836387269" MODIFIED="1609836403488">
<node TEXT="-A  (add)添加虚拟服务器" ID="ID_1397699477" CREATED="1609836414638" MODIFIED="1609836457128"/>
<node TEXT="-E  (edit)修改虚拟服务器" ID="ID_1995492637" CREATED="1609836457958" MODIFIED="1609836475638"/>
<node TEXT="-D  (delete)删除虚拟服务器" ID="ID_41238742" CREATED="1609836476338" MODIFIED="1609836499258"/>
<node TEXT="-C  (clear)清空所有" ID="ID_1293799334" CREATED="1609836499538" MODIFIED="1609836528028"/>
<node TEXT="-a   (add)添加真实服务器" ID="ID_1712991677" CREATED="1609836528188" MODIFIED="1609836551918"/>
<node TEXT="-e   (edit)修改真实服务器" ID="ID_311076134" CREATED="1609836552138" MODIFIED="1609836565597"/>
<node TEXT="-d   (delete)删除真实服务器" ID="ID_301958884" CREATED="1609836565838" MODIFIED="1609836584318"/>
<node TEXT="-L   (list)查看LVS规则表" ID="ID_467015022" CREATED="1609836585299" MODIFIED="1609836609248"/>
<node TEXT="-s [rr|wrr|lc|wlc|sh]   (scheduler)指定集群算法" ID="ID_1070750515" CREATED="1609836609588" MODIFIED="1609836676575"/>
</node>
<node TEXT="ipvsadm语法案例" ID="ID_1124053519" CREATED="1609836678916" MODIFIED="1609836694015">
<node TEXT="特点" ID="ID_119016489" CREATED="1609837515602" MODIFIED="1609837518502">
<node TEXT="虚拟服务器需设置算法,真实服务器需设置工作模式和权重" ID="ID_401578548" CREATED="1609837518538" MODIFIED="1609837542952"/>
</node>
<node TEXT="ipvsadm -A -t|u 192.168.4.5:80 -s [算法]   添加虚拟服务器,协议为tcp(-t)或者udp(-u)" ID="ID_1348657289" CREATED="1609836694036" MODIFIED="1609836762355"/>
<node TEXT="ipvsadm -E -t|u 192.168.4.5:80 -s [算法]   修改虚拟服务器的协议和算法" ID="ID_476826565" CREATED="1609836763195" MODIFIED="1609836822925"/>
<node TEXT="ipvsadm -D -t|u 192.168.4.5:80   删除虚拟服务器" ID="ID_1036401961" CREATED="1609836823725" MODIFIED="1609836864685"/>
<node TEXT="ipvsadm -C   清空所有" ID="ID_381392964" CREATED="1609836865735" MODIFIED="1609836896945"/>
<node TEXT="ipvsadm -a -t|u 192.168.4.5:80 -r 192.168.2.100 [-g|i|m] [-w 权重]   添加为虚拟服务器添加真实服务器,-g为DR模式,-i为TUN模式,-m为NAT模式,默认权重1" ID="ID_153212264" CREATED="1609836899075" MODIFIED="1609837035935"/>
<node TEXT="ipvsadm -e -t|u 192.168.4.5:80 -r 192.168.2.100 [-g|i|m] [-w 权重]   修改真实服务器" ID="ID_315871645" CREATED="1609837037075" MODIFIED="1609837139791"/>
<node TEXT="ipvsadm -d -t|u 192.168.4.5:80 -r 192.168.2.100   删除真实服务器" ID="ID_1214168093" CREATED="1609837143451" MODIFIED="1609837175661"/>
<node TEXT="ipvsadm -Ln   查看LVS规则列表" ID="ID_1702214146" CREATED="1609837176971" MODIFIED="1609837196761"/>
</node>
<node TEXT="永久保存所有规则" ID="ID_739788872" CREATED="1609837443181" MODIFIED="1609837592452">
<node TEXT="需确保ipvsadm服务为自启动" ID="ID_1973629170" CREATED="1609837592462" MODIFIED="1609837609902">
<node TEXT="systemctl enalbe ipvsadm" ID="ID_1545077345" CREATED="1609837609922" MODIFIED="1609837632359"/>
</node>
<node TEXT="ipvsadm-save -n &gt; /etc/sysconfig/ipvsadm" ID="ID_1735188360" CREATED="1609837633302" MODIFIED="1609837661832"/>
</node>
</node>
</node>
<node TEXT="LVS-NAT集群部署" POSITION="right" ID="ID_1893692556" CREATED="1609837674832" MODIFIED="1609837693642">
<edge COLOR="#00ff00"/>
<node TEXT="环境" ID="ID_1436215097" CREATED="1609837693652" MODIFIED="1609837697052">
<node TEXT="client" ID="ID_1562650590" CREATED="1609837697062" MODIFIED="1609837740773">
<node TEXT="eth0:192.168.4.10/24" ID="ID_1001296065" CREATED="1609837743514" MODIFIED="1609837748304"/>
</node>
<node TEXT="proxy" ID="ID_916938480" CREATED="1609837717655" MODIFIED="1609837731734">
<node TEXT="eth0:192.168.4.5/24" ID="ID_1114435318" CREATED="1609837758253" MODIFIED="1609837770464"/>
<node TEXT="eth1:192.168.2.5/24" ID="ID_201728309" CREATED="1609837770654" MODIFIED="1609837802294"/>
</node>
<node TEXT="web1" ID="ID_878401642" CREATED="1609837803914" MODIFIED="1609837810704">
<node TEXT="eth0:192.168.2.100/24 网关192.168.2.5" ID="ID_434312161" CREATED="1609837810714" MODIFIED="1609837848304"/>
</node>
<node TEXT="web2" ID="ID_1793964811" CREATED="1609837858754" MODIFIED="1609837863283">
<node TEXT="eth0:192.168.2.200/24 网关192.168.2.5" ID="ID_1810998491" CREATED="1609837863304" MODIFIED="1609837885133"/>
</node>
</node>
<node TEXT="部署LVS-NAT模式调度器" ID="ID_71907612" CREATED="1609837888774" MODIFIED="1609838339840">
<node TEXT="开启路由转发" ID="ID_1506492927" CREATED="1609838341300" MODIFIED="1609838356580">
<node TEXT="echo 1 &gt; /proc/sys/net/ipv4/ip_forward   开启" ID="ID_1340360936" CREATED="1609838423070" MODIFIED="1609838578566"/>
<node ID="ID_1518318619" CREATED="1609838489830" MODIFIED="1609838558736"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      echo &quot;<b>net.ipv4.ip_forward = 1</b>&quot; &gt;&gt; /etc/sysctl.conf&nbsp;&nbsp;永久
    </p>
  </body>
</html>

</richcontent>
</node>
</node>
<node TEXT="创建集群" ID="ID_1951141075" CREATED="1609838605516" MODIFIED="1609838617180">
<node TEXT="ipvsadm -A -t 192.168.4.5:80 -s wrr" ID="ID_1932730022" CREATED="1609838617196" MODIFIED="1609838641186"/>
</node>
<node TEXT="添加真实主机到集群" ID="ID_642282760" CREATED="1609838644376" MODIFIED="1609838654986">
<node TEXT="ipvsadm -a -t 192.168.4.5:80 -r 192.168.2.100 -m -w 1" ID="ID_1606314523" CREATED="1609838655001" MODIFIED="1609838696136"/>
<node TEXT="ipvsadm -a -t 192.168.4.5:80 -r 192.168.2.200 -m -w 1" ID="ID_1355713160" CREATED="1609838698106" MODIFIED="1609838724616"/>
</node>
<node TEXT="配置防火墙和selinux策略放行" ID="ID_123644311" CREATED="1609838746730" MODIFIED="1609838763330"/>
</node>
</node>
<node TEXT="LVS-DR集群部署" POSITION="right" ID="ID_1096622249" CREATED="1609838770550" MODIFIED="1609838786070">
<edge COLOR="#ff00ff"/>
<node TEXT="环境" ID="ID_1152186559" CREATED="1609838786080" MODIFIED="1609838819349">
<node TEXT="client" ID="ID_1917767352" CREATED="1609838819370" MODIFIED="1609838830559">
<node TEXT="eth0:192.168.4.10/24" ID="ID_1536914059" CREATED="1609838830580" MODIFIED="1609838842970"/>
</node>
<node TEXT="proxy" ID="ID_1245814597" CREATED="1609838844149" MODIFIED="1609838847710">
<node TEXT="eth0:192.168.4.5/24" ID="ID_1153211748" CREATED="1609838847730" MODIFIED="1609838866349"/>
<node TEXT="eth0:0  192.168.4.15/24" ID="ID_1190880145" CREATED="1609838867440" MODIFIED="1609839557171"/>
</node>
<node TEXT="web1" ID="ID_76378416" CREATED="1609838879950" MODIFIED="1609838883437">
<node TEXT="eth0:192.168.4.100/24" ID="ID_167091565" CREATED="1609838883452" MODIFIED="1609838902989"/>
<node TEXT="lo:0  192.168.4.15/32" ID="ID_920027240" CREATED="1609838903320" MODIFIED="1609838926730"/>
</node>
<node TEXT="web2" ID="ID_459639558" CREATED="1609838939819" MODIFIED="1609838948140">
<node TEXT="eth0:192.168.4.200" ID="ID_840706519" CREATED="1609838948155" MODIFIED="1609838962749"/>
<node TEXT="lo:0  192.168.4.15/32" ID="ID_763616353" CREATED="1609838963030" MODIFIED="1609838975710"/>
</node>
</node>
<node TEXT="网络环境配置" ID="ID_146322100" CREATED="1609839005715" MODIFIED="1609839017215">
<node TEXT="地址欺骗" ID="ID_1319397284" CREATED="1609839017235" MODIFIED="1609839096035">
<node TEXT="将虚拟IP配置在真实主机lo本地回环网卡上掩码使用32位" ID="ID_259247337" CREATED="1609839096045" MODIFIED="1609839229693"/>
<node TEXT="proxy" ID="ID_200169992" CREATED="1609839453823" MODIFIED="1609839460753">
<node TEXT="cp /etc/sysconfig/network-scripts/ifcfg-eth0{,:0}" ID="ID_66386046" CREATED="1609839366153" MODIFIED="1609839450648"/>
<node TEXT="vim /etc/sysconfig/network-scripts/ifcfg-eth0:0&#xa;TYPE=Ethernet&#xa;#网卡类型为：以太网卡&#xa;BOOTPROTO=none&#xa;#none手动配置IP，或者dhcp自动配置IP&#xa;NAME=eth0:0&#xa;#网卡名称&#xa;DEVICE=eth0:0&#xa;#设备名称&#xa;ONBOOT=yes&#xa;#开机时是否自动激活该网卡&#xa;IPADDR=192.168.4.15&#xa;#IP地址&#xa;PREFIX=24&#xa;#子网掩码" ID="ID_1696645711" CREATED="1609839484921" MODIFIED="1609839537481"/>
<node TEXT="systemctl restart network" ID="ID_914756328" CREATED="1609839592511" MODIFIED="1609839607001"/>
</node>
<node TEXT="web" ID="ID_1704751351" CREATED="1609839619121" MODIFIED="1609839634611">
<node TEXT="cp /etc/sysconfig/network-scripts/ifcfg-lo{,:0}" ID="ID_838592861" CREATED="1609839634631" MODIFIED="1609839702959"/>
<node TEXT="vim /etc/sysconfig/network-scripts/ifcfg-lo:0&#xa;DEVICE=lo:0&#xa;#设备名称&#xa;IPADDR=192.168.4.15&#xa;#IP地址&#xa;NETMASK=255.255.255.255&#xa;#子网掩码&#xa;NETWORK=192.168.4.15&#xa;#网络地址&#xa;BROADCAST=192.168.4.15&#xa;#广播地址&#xa;ONBOOT=yes&#xa;#开机是否激活本网卡&#xa;NAME=lo:0&#xa;#网卡名称" ID="ID_279473724" CREATED="1609839704321" MODIFIED="1609839754356"/>
<node TEXT="解决ARP冲突" ID="ID_866744380" CREATED="1609839258884" MODIFIED="1609839312594">
<node TEXT="由于真实主机使用了调度器虚拟IP相同的IP,会产生ARP冲突" ID="ID_40837271" CREATED="1609839312613" MODIFIED="1609839356993"/>
<node TEXT="vim /etc/sysctl.conf&#xa;#文件末尾手动写入如下4行内容,英语词汇：ignore（忽略、忽视），announce（宣告、广播通知）&#xa;net.ipv4.conf.all.arp_ignore = 1&#xa;net.ipv4.conf.lo.arp_ignore = 1&#xa;net.ipv4.conf.lo.arp_announce = 2&#xa;net.ipv4.conf.all.arp_announce = 2&#xa;#当有arp广播问谁是192.168.4.15时，本机忽略该ARP广播，不做任何回应（防止进站冲突）&#xa;#本机不要向外宣告自己的lo回环地址是192.168.4.15（防止出站冲突）" ID="ID_1200595507" CREATED="1609839789666" MODIFIED="1609839844920"/>
<node TEXT="sysctl -p" ID="ID_458735883" CREATED="1609839856396" MODIFIED="1609839863386"/>
</node>
<node TEXT="systemctl restart network" ID="ID_1830579998" CREATED="1609839877876" MODIFIED="1609839894426"/>
</node>
<node TEXT="注意NetworkManager和network有冲突,需要关闭NetworkManager" ID="ID_707795085" CREATED="1609839927676" MODIFIED="1609842749336"/>
</node>
</node>
<node TEXT="proxy" ID="ID_822673929" CREATED="1609842753846" MODIFIED="1609842809132">
<node TEXT="创建集群" ID="ID_322876986" CREATED="1609842809153" MODIFIED="1609842829593">
<node TEXT="ipvsadm -A -t 192.168.4.15:80 -s wrr" ID="ID_654591173" CREATED="1609842829603" MODIFIED="1609842855482"/>
</node>
<node TEXT="添加真实主机并设定为DR模式" ID="ID_437437938" CREATED="1609842866133" MODIFIED="1609842883083">
<node TEXT="ipvsadm -a -t 192.168.4.15:80 -r 192.168.4.100 -g -w 1" ID="ID_1537928984" CREATED="1609842883104" MODIFIED="1609842950013"/>
<node TEXT="ipvsadm -a -t 192.168.4.15:80 -r 192.168.4.200 -g -w 1" ID="ID_1573278911" CREATED="1609842910733" MODIFIED="1609842939322"/>
</node>
</node>
</node>
<node TEXT="健康检查脚本" POSITION="right" ID="ID_185178911" CREATED="1609843001447" MODIFIED="1609843008703">
<edge COLOR="#00ffff"/>
<node TEXT="vim check.sh&#xa;#!/bin/bash&#xa;VIP=192.168.4.15:80&#xa;RIP1=192.168.4.100&#xa;RIP2=192.168.4.200&#xa;while :&#xa;do&#xa;   for IP in $RIP1 $RIP2&#xa;   do&#xa;           curl -s http://$IP &amp;&gt;/dev/null&#xa;if [ $? -eq 0 ];then&#xa;            ipvsadm -Ln |grep -q $IP || ipvsadm -a -t $VIP -r $IP&#xa;        else&#xa;             ipvsadm -Ln |grep -q $IP &amp;&amp; ipvsadm -d -t $VIP -r $IP&#xa;        fi&#xa;   done&#xa;sleep 1&#xa;done" ID="ID_1255753148" CREATED="1609843008712" MODIFIED="1609843045778"/>
</node>
</node>
</map>
